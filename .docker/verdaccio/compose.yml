services:
  verdaccio:
    image: verdaccio/verdaccio:5
    container_name: verdaccio
    networks:
      - registry
    ports:
      - target: 4873
        published: 4873
        protocol: tcp
    volumes:
      - verdaccio_storage:/verdaccio/storage
      - ./config.yaml:/verdaccio/conf/config.yaml:ro
    environment:
      VERDACCIO_PUBLIC_URL: http://localhost:4873
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:4873/-/ping"]
      interval: 30s
      timeout: 10s
      start_period: 10s
      retries: 3
    restart: unless-stopped

volumes:
  verdaccio_storage:
    driver: local
    name: portfolio_verdaccio_storage

networks:
  registry:
    driver: bridge
    name: portfolio_registry
