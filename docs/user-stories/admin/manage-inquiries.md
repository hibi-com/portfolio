---
title: 問い合わせ管理
description: 管理者による問い合わせの確認と返信
---

## ストーリー

**As a** Admin（管理者）
**I want to** 問い合わせを確認・返信したい
**So that** 訪問者からの問い合わせに適切に対応できる

## ペルソナ

| 属性 | 値 |
| ---- | -- |
| 名前 | Admin |
| 役割 | admin |
| 技術レベル | 中級者〜上級者 |
| 主な目的 | 問い合わせ対応 |

## 前提条件

- 管理者としてログイン済み
- 管理画面にアクセス可能

## 受け入れ条件（Acceptance Criteria）

### AC1: 問い合わせ一覧の表示

**Given** 管理者がログインしている
**When** 問い合わせ管理ページにアクセスする
**Then** すべての問い合わせが新着順に表示される

### AC2: 問い合わせ詳細の表示

**Given** 問い合わせ一覧に問い合わせが存在する
**When** 問い合わせをクリックする
**Then** 問い合わせの詳細と履歴が表示される

### AC3: 問い合わせへの返信

**Given** 問い合わせ詳細ページにいる
**When** 返信を入力して送信する
**Then** 返信が保存され、メールが送信される

### AC4: ステータスの変更

**Given** 問い合わせ詳細ページにいる
**When** ステータスを変更する
**Then** 問い合わせのステータスが更新される

### AC5: 未読/既読の管理

**Given** 問い合わせ一覧に未読の問い合わせがある
**When** 問い合わせ詳細を開く
**Then** 問い合わせが既読になる

## シナリオ

### 正常系シナリオ

1. 管理者は管理画面にログインする
2. サイドバーから「問い合わせ」をクリックする
3. 問い合わせ一覧が表示される（未読数バッジあり）
4. 未読の問い合わせをクリックする
5. 詳細が表示され、既読になる
6. 返信を入力して「送信」をクリックする
7. 返信が保存され、ステータスを「対応中」に変更
8. 対応完了後、ステータスを「完了」に変更

### 異常系シナリオ

1. 返信が空の場合、バリデーションエラー
2. メール送信に失敗した場合、リトライオプションを表示

## UI/UX要件

### 画面構成

```text
┌─────────────────────────────────────────────┐
│ Header (Navigation)                          │
├──────────┬──────────────────────────────────┤
│          │ 問い合わせ        [フィルター]    │
│ Sidebar  ├────────────┬─────────────────────┤
│          │ 一覧       │ 詳細                │
│          │ ┌────────┐ │ From: xxx@xxx.com  │
│          │ │ 件名1  │ │ Subject: ...       │
│          │ │ 件名2  │ │ Message: ...       │
│          │ │ 件名3  │ │ ─────────────────  │
│          │ └────────┘ │ [返信フォーム]      │
│          │            │ [送信]              │
└──────────┴────────────┴─────────────────────┘
```

### 必要な要素

| 要素 | 種類 | 説明 |
| ---- | ---- | ---- |
| 問い合わせリスト | list | 件名、送信者、日時を表示 |
| 未読バッジ | badge | 未読数を表示 |
| ステータスドロップダウン | select | 新規/対応中/完了/保留 |
| 返信フォーム | textarea | 返信入力欄 |
| 送信ボタン | button | 返信を送信 |

## テスト

### E2Eテスト

- ファイル: `apps/admin/e2e/large/admin/manage-inquiries.large.spec.ts`
- 対応するAC: AC1, AC2, AC3, AC4, AC5

### テストシナリオ

| シナリオ | AC | 自動化 |
| -------- | -- | ------ |
| 一覧表示 | AC1 | Yes |
| 詳細表示 | AC2 | Yes |
| 返信送信 | AC3 | Yes |
| ステータス変更 | AC4 | Yes |
| 既読管理 | AC5 | Yes |

## 関連

- シーケンス図: `docs/sequence/admin/inquiries/`
- API仕様: `docs/specs/api/inquiry.md`
- 画面: `apps/admin/app/routes/inquiries/`
