---
title: "パフォーマンス最適化"
---

フロントエンドのパフォーマンスは次のルールを守る。  
実装例はリポジトリを参照すること。

## データ取得

- ローダーでは **必要なデータだけ** を取得する。複数ソースは **Promise.all** で並列化する。直列の await を並べない。
- 静的・準静的なデータには **Cache-Control** を付与し、CDN・ブラウザのキャッシュを活用する。

## プリフェッチ・リンク

- **Link** には **prefetch="intent"** を付け、ホバー時にプリフェッチする。重要なルートは **prefetch="render"** を検討する。

## 画像

- 画像には **loading="lazy"** を付ける。**width** と **height** を指定してレイアウトシフトを防ぐ。**alt** は必須とする。
- 大きな画像や遅延表示でよいものは、可能なら WebP 等のフォーマットと適切なサイズで配信する。

## React の最適化

- **React.memo** は、Props が変わらない限り再レンダーを防ぎたいコンポーネント（リストのアイテム等）に使う。過度な memo は避ける。
- コストの高い計算は **useMemo**、子に渡すコールバックは **useCallback** でメモ化する。依存配列は正確に指定する。
- 大きなコンポーネントやライブラリは **lazy** と **Suspense** で遅延読み込みする。fallback を必ず指定する。

## バンドル

- インポートは **必要な名前だけ** にする。`import * as X` でまとめてインポートしない。ツリーシェイキングが効くようにする。
- 使っていない依存関係は削除する。軽量な代替がある場合は検討する。

## メタデータ

- **meta** 関数では、必要なタグだけを返す。動的タイトル・description は loader の data から渡す。

## 目標値・検証

- Lighthouse のパフォーマンス・アクセシビリティ・ベストプラクティス・SEO は、いずれも **90 点以上** を目標とする。
- 検証は **bun run lighthouse**（またはプロジェクトで定めたスクリプト）で行う。実行方法はルートの package.json を参照する。

## 禁止事項

- ローダーで並列化できるのに直列の await で待ち合わせない。
- 画像に width/height を付けずに表示しない（CLS 防止）。
- 巨大なコンポーネントを遅延読み込みせずにルートで同期的に import しない（必要なら lazy を使う）。
- 未使用の import や依存を残さない。
