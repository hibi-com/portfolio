#!/usr/bin/env bun
// @bun
var Qt=Object.create;var{getPrototypeOf:Yt,defineProperty:j,getOwnPropertyNames:Lt}=Object;var Wt=Object.prototype.hasOwnProperty;var G=(t,n,e)=>{e=t!=null?Qt(Yt(t)):{};let s=n||!t||!t.__esModule?j(e,"default",{value:t,enumerable:!0}):e;for(let o of Lt(t))if(!Wt.call(s,o))j(s,o,{get:()=>t[o],enumerable:!0});return s};var zt=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var st=(t,n)=>{for(var e in n)j(t,e,{get:n[e],enumerable:!0,configurable:!0,set:(s)=>n[e]=()=>s})};var $=(t,n)=>()=>(t&&(n=t(t=0)),n);var T=zt((Se,Y)=>{var M=process||{},mt=M.argv||[],q=M.env||{},on=!(!!q.NO_COLOR||mt.includes("--no-color"))&&(!!q.FORCE_COLOR||mt.includes("--color")||M.platform==="win32"||(M.stdout||{}).isTTY&&q.TERM!=="dumb"||!!q.CI),rn=(t,n,e=t)=>(s)=>{let o=""+s,r=o.indexOf(n,t.length);return~r?t+ln(o,n,e,r)+n:t+o+n},ln=(t,n,e,s)=>{let o="",r=0;do o+=t.substring(r,s)+e,r=s+n.length,s=t.indexOf(n,r);while(~s);return o+t.substring(r)},pt=(t=on)=>{let n=t?rn:()=>String;return{isColorSupported:t,reset:n("\x1B[0m","\x1B[0m"),bold:n("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"),dim:n("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"),italic:n("\x1B[3m","\x1B[23m"),underline:n("\x1B[4m","\x1B[24m"),inverse:n("\x1B[7m","\x1B[27m"),hidden:n("\x1B[8m","\x1B[28m"),strikethrough:n("\x1B[9m","\x1B[29m"),black:n("\x1B[30m","\x1B[39m"),red:n("\x1B[31m","\x1B[39m"),green:n("\x1B[32m","\x1B[39m"),yellow:n("\x1B[33m","\x1B[39m"),blue:n("\x1B[34m","\x1B[39m"),magenta:n("\x1B[35m","\x1B[39m"),cyan:n("\x1B[36m","\x1B[39m"),white:n("\x1B[37m","\x1B[39m"),gray:n("\x1B[90m","\x1B[39m"),bgBlack:n("\x1B[40m","\x1B[49m"),bgRed:n("\x1B[41m","\x1B[49m"),bgGreen:n("\x1B[42m","\x1B[49m"),bgYellow:n("\x1B[43m","\x1B[49m"),bgBlue:n("\x1B[44m","\x1B[49m"),bgMagenta:n("\x1B[45m","\x1B[49m"),bgCyan:n("\x1B[46m","\x1B[49m"),bgWhite:n("\x1B[47m","\x1B[49m"),blackBright:n("\x1B[90m","\x1B[39m"),redBright:n("\x1B[91m","\x1B[39m"),greenBright:n("\x1B[92m","\x1B[39m"),yellowBright:n("\x1B[93m","\x1B[39m"),blueBright:n("\x1B[94m","\x1B[39m"),magentaBright:n("\x1B[95m","\x1B[39m"),cyanBright:n("\x1B[96m","\x1B[39m"),whiteBright:n("\x1B[97m","\x1B[39m"),bgBlackBright:n("\x1B[100m","\x1B[49m"),bgRedBright:n("\x1B[101m","\x1B[49m"),bgGreenBright:n("\x1B[102m","\x1B[49m"),bgYellowBright:n("\x1B[103m","\x1B[49m"),bgBlueBright:n("\x1B[104m","\x1B[49m"),bgMagentaBright:n("\x1B[105m","\x1B[49m"),bgCyanBright:n("\x1B[106m","\x1B[49m"),bgWhiteBright:n("\x1B[107m","\x1B[49m")}};Y.exports=pt();Y.exports.createColors=pt});var dt={};st(dt,{setupComposeSecrets:()=>L,logSubStep:()=>c,logStep:()=>m,logSection:()=>v,LoadingBar:()=>d,COMPOSE_ENV_ONLY_DEFAULTS:()=>mn});import{existsSync as ht,mkdirSync as an,writeFileSync as cn}from"fs";import{join as ft}from"path";function v(t){console.log(),console.log(C.default.bold(C.default.cyan(`  ${t}`))),console.log(C.default.dim(`  ${"\u2500".repeat(50)}`))}function m(t,n,e="info"){let s={info:C.default.blue,success:C.default.green,warning:C.default.yellow,error:C.default.red},o;if(e==="success")o="\u2713";else if(e==="error")o="\u2717";else if(e==="warning")o="\u26A0";else o="\u2192";console.log(`  ${s[e](o)} ${t} ${n}`)}function c(t,n="info"){let e={info:C.default.dim,success:C.default.green,warning:C.default.yellow},s;if(n==="success")s="\u2713";else if(n==="warning")s="\u26A0";else s="  ";console.log(`    ${e[n](s)} ${t}`)}class d{message;interval=null;frames=["\u280B","\u2819","\u2839","\u2838","\u283C","\u2834","\u2826","\u2827","\u2807","\u280F"];frameIndex=0;isActive=!1;constructor(t){this.message=t}start(){if(this.isActive)return;this.isActive=!0,this.frameIndex=0,this.interval=setInterval(()=>{let t=this.frames[this.frameIndex%this.frames.length];process.stdout.write(`\r    ${C.default.cyan(t)} ${C.default.dim(this.message)}`),this.frameIndex++},100)}stop(t=!0,n){if(!this.isActive)return;if(this.isActive=!1,this.interval)clearInterval(this.interval),this.interval=null;if(process.stdout.write(`\r${" ".repeat(80)}\r`),n)c(n,t?"success":"warning")}}async function L(t){v("\uD83D\uDCDD \u74B0\u5883\u8A2D\u5B9A\uFF08compose secrets\uFF09");let n=ft(t,_);if(!ht(n))m("\uD83D\uDCDD",`${_}/ \u3092\u4F5C\u6210\u3057\u3066\u3044\u307E\u3059...`,"info"),an(n,{recursive:!0});let e=0;for(let[s,o]of Object.entries(un)){let r=ft(n,s);if(ht(r))continue;cn(r,o,"utf-8"),c(`${s} \u3092\u4F5C\u6210\u3057\u307E\u3057\u305F\uFF08\u958B\u767A\u7528\u30C7\u30D5\u30A9\u30EB\u30C8\uFF09`,"info"),e++}if(e>0)m("",`${_}/ \u306B ${e} \u4EF6\u306E\u30B7\u30FC\u30AF\u30EC\u30C3\u30C8\u30D5\u30A1\u30A4\u30EB\u3092\u4F5C\u6210\u3057\u307E\u3057\u305F`,"success");else m("",`${_}/ \u306F\u65E2\u306B\u63C3\u3063\u3066\u3044\u307E\u3059`,"success")}var C,_=".docker/secrets",un,mn;var y=$(()=>{C=G(T(),1),un={database_url:"mysql://user:password@tidb:4000/portfolio",redis_url:"redis://:password@cache:6379",better_auth_secret:"your-secret-key-here",better_auth_url:"http://localhost:3000",google_client_id:"",google_client_secret:"",cloudflare_account_id:"",cloudflare_api_token:"",node_env:"development",api_base_url:"http://localhost:8787",vite_base_url:"http://localhost:5173",sentry_dsn:"",sentry_org:"",sentry_project:"",sentry_auth_token:"",app_version:"1.0.0"},mn={VITE_GOOGLE_ANALYTICS_ENABLED:"false",VITE_GOOGLE_TAG_MANAGER_ENABLED:"false",VITE_XSTATE_INSPECTOR_ENABLED:"true",VITE_SENTRY_ENVIRONMENT:"development",VITE_SENTRY_TRACES_SAMPLE_RATE:"1",VITE_SENTRY_REPLAY_SAMPLE_RATE:"0",VITE_SENTRY_REPLAY_ON_ERROR_SAMPLE_RATE:"0"}});var{$:x}=globalThis.Bun;import{existsSync as gt}from"fs";import{createInterface as pn}from"readline";async function xt(t){let n=process.env.PATH||"",e=t,s="",o=!0;if(t==="pulumi"){let r=process.env.HOME||process.env.USERPROFILE||"~",l=`${r}/.pulumi/bin`,u=`${l}/pulumi`;if(gt(u)){if(!n.includes(l))o=!1;e=u}else if(gt(l))s=`${l}:`,process.env.PATH=`${s}${n}`;else return{installed:!1,inPath:!1};process.env.PULUMI_HOME=`${r}/.pulumi`}try{return await x`${e} ${t==="pulumi"?"version":"--version"}`.quiet(),{installed:!0,inPath:o}}catch{return{installed:!1,inPath:!1}}}async function hn(t){let n=pn({input:process.stdin,output:process.stdout});return new Promise((e)=>{n.question(t,(s)=>{n.close();let o=s.trim().toLowerCase();e(o==="y"||o==="yes"||o==="\u306F\u3044")})})}async function fn(){m("","nvm\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...","info");try{await x`curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash`.quiet(),m("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success"),m("","\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3059\u308B\u304B\u3001\u4EE5\u4E0B\u306E\u30B3\u30DE\u30F3\u30C9\u3092\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export NVM_DIR="$HOME/.nvm"`)),console.log(g.default.dim(String.raw`    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"`)),console.log(g.default.dim(String.raw`    nvm install --lts`)),console.log(),console.log(g.default.yellow("  \u6CE8\u610F: node\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306F\u30B7\u30A7\u30EB\u306E\u518D\u8D77\u52D5\u304C\u5FC5\u8981\u3067\u3059\u3002"))}catch(t){throw m("","nvm\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),t}}async function dn(){if(process.platform==="darwin")throw m("","macOS\u3067\u306FDocker Desktop\u304C\u5FC5\u8981\u3067\u3059\u3002get.docker.com\u30B9\u30AF\u30EA\u30D7\u30C8\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning"),m("","Docker Desktop\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://www.docker.com/products/docker-desktop","info"),new Error("macOS\u3067\u306FDocker Desktop\u304C\u5FC5\u8981\u3067\u3059\u3002get.docker.com\u30B9\u30AF\u30EA\u30D7\u30C8\u306F\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u3066\u3044\u307E\u305B\u3093");let t=new d("Docker\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");t.start();try{if((await x`curl -fsSL https://get.docker.com/ | sh`.quiet()).exitCode!==0)throw t.stop(!1),new Error("Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F");t.stop(!0,"Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(n){throw t.stop(!1),m("","Docker\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),n}}async function gn(){try{return await x`which gpg`.quiet(),!0}catch{return!1}}async function bn(){if(!await gn()){if(m("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306FGnuPG\u304C\u5FC5\u8981\u3067\u3059\u3002gpg\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","error"),m("","GnuPG\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044:","info"),process.platform==="darwin")console.log(g.default.dim("    brew install gnupg"));else console.log(g.default.dim("    apt-get install gnupg  # Debian/Ubuntu")),console.log(g.default.dim("    yum install gnupg       # RHEL/CentOS"));throw new Error("Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u306FGnuPG\u304C\u5FC5\u8981\u3067\u3059\u3002gpg\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093")}let n=new d("Doppler CLI\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");n.start();try{let s=`${process.env.HOME||process.env.USERPROFILE||"~"}/.local/bin`;await x`mkdir -p ${s}`.quiet();let o=await x`bash -c "curl -Ls --tlsv1.2 --proto '=https' --retry 3 https://cli.doppler.com/install.sh | sh -s -- --install-path ${s}"`.quiet();if(o.exitCode!==0){let r=o.stderr.toString()||o.stdout.toString();throw n.stop(!1),new Error(`\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${r}`)}n.stop(!0,"Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F"),m("",`Doppler CLI\u306F ${s} \u306B\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u307E\u3057\u305F`,"info"),m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export PATH="$HOME/.local/bin:$PATH"`))}catch(e){if(n.stop(!1),m("","Doppler CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),e instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${e.message}`));throw e}}async function wn(){let t=new d("Codex CLI\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...");t.start();try{let n=await fetch("https://api.github.com/repos/openai/codex/releases/latest");if(!n.ok)throw t.stop(!1),new Error(`GitHub API\u30A8\u30E9\u30FC: ${n.status}`);let e=await n.json(),r=(await x`uname -m`.quiet()).stdout.toString().trim()==="arm64"?"aarch64":"x86_64",l=`codex-${r}-apple-darwin.tar.gz`,u=e.assets.find((Vt)=>Vt.name===l);if(!u)throw t.stop(!1),new Error(`\u30A2\u30BB\u30C3\u30C8\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${l}`);let i=`/tmp/${l}`;if((await x`curl -fsSL -o ${i} ${u.browser_download_url}`.quiet()).exitCode!==0)throw t.stop(!1),new Error("\u30C0\u30A6\u30F3\u30ED\u30FC\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F");let f=await x`tar -xzf ${i} -C /tmp`.quiet();if(f.exitCode!==0)throw t.stop(!1),new Error(`\u89E3\u51CD\u306B\u5931\u6557\u3057\u307E\u3057\u305F: ${f.stderr.toString()}`);let w=`/tmp/${`codex-${r}-apple-darwin`}`;if((await x`test -f ${w}`.quiet()).exitCode!==0)throw t.stop(!1),new Error(`\u89E3\u51CD\u5F8C\u306Ecodex\u30D0\u30A4\u30CA\u30EA\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093: ${w}`);let S=`${process.env.HOME||process.env.USERPROFILE||"~"}/.local/bin`;if(await x`mkdir -p ${S}`.quiet(),(await x`mv ${w} ${S}/codex`.quiet()).exitCode!==0)throw t.stop(!1),new Error("\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F");await x`chmod +x ${S}/codex`.quiet(),await x`rm ${i}`.quiet(),t.stop(!0,`Codex CLI ${e.tag_name} \u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`),m("",`Codex CLI\u306F ${S} \u306B\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u307E\u3057\u305F`,"info"),m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),console.log(g.default.dim(String.raw`    export PATH="$HOME/.local/bin:$PATH"`))}catch(n){if(t.stop(!1),m("","Codex CLI\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F","error"),n instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${n.message}`));throw n}}async function xn(t){if(typeof t.installScript==="string"){let n=new d(`${t.name}\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059...`);n.start();try{let e=await x`bash -c ${t.installScript}`.quiet();if(e.exitCode!==0){let s=e.stderr.toString()||e.stdout.toString();if(n.stop(!1),m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),s)console.error(g.default.dim(`  \u30A8\u30E9\u30FC\u51FA\u529B: ${s.trim()}`));throw new Error(`\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u30B9\u30AF\u30EA\u30D7\u30C8\u304C\u7D42\u4E86\u30B3\u30FC\u30C9 ${e.exitCode} \u3067\u7D42\u4E86\u3057\u307E\u3057\u305F`)}n.stop(!0,`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F`)}catch(e){if(n.stop(!1),m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),e instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${e.message}`));if(process.env.DEBUG)console.error(e);throw e}}else await t.installScript()}function vn(t){if(t!=="pulumi")return;let n=process.env.HOME||process.env.USERPROFILE||"~";if(m("","PATH\u306B\u8FFD\u52A0\u3059\u308B\u306B\u306F\u3001\u30B7\u30A7\u30EB\u8A2D\u5B9A\u30D5\u30A1\u30A4\u30EB\u306B\u4EE5\u4E0B\u3092\u8FFD\u52A0\u3057\u3066\u304F\u3060\u3055\u3044:","info"),(process.env.SHELL||"").includes("fish"))console.log(g.default.dim(String.raw`    fish_add_path ${n}/.pulumi/bin`));else console.log(g.default.dim(String.raw`    export PATH="$HOME/.pulumi/bin:$PATH"`))}function vt(t,n,e){let s=e?`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059`:`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u78BA\u8A8D\u3055\u308C\u307E\u3057\u305F`;if(n)m("",s,"success");else{let o=e?`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059\u304C\u3001PATH\u306B\u542B\u307E\u308C\u3066\u3044\u307E\u305B\u3093`:`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u78BA\u8A8D\u3055\u308C\u307E\u3057\u305F\u304C\u3001PATH\u306B\u542B\u307E\u308C\u3066\u3044\u307E\u305B\u3093`;m("",o,"warning"),vn(t.name)}}async function Cn(t,n){let e=n?"\uFF08\u30AA\u30D7\u30B7\u30E7\u30F3\uFF09":"",s=`${t.name}\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093${e}\u3002\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u307E\u3059\u304B\uFF1F (y/n): `;if(!await hn(s)){let r=n?"info":"warning";return m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F`,r),!1}return!0}async function yn(t){try{await xn(t);let{installed:n,inPath:e}=await xt(t.checkCommand);if(n)vt(t,e,!1);else m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u5F8C\u3001\u30B3\u30DE\u30F3\u30C9\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002\u30B7\u30A7\u30EB\u3092\u518D\u8D77\u52D5\u3057\u3066\u304F\u3060\u3055\u3044`,"warning")}catch(n){if(m("",`${t.name}\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F`,"error"),n instanceof Error)console.error(g.default.dim(`  \u30A8\u30E9\u30FC: ${n.message}`));if(process.env.DEBUG)console.error(n)}}async function Sn(t,n){let{installed:e,inPath:s}=await xt(t.checkCommand);if(e){vt(t,s,!0);return}if(!await Cn(t,n))return;await yn(t)}async function wt(t,n){if(n&&t.length>0)console.log(),m("","\u30AA\u30D7\u30B7\u30E7\u30F3\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D","info");for(let e of t){if(!e)continue;await Sn(e,n)}}async function H(){v("\uD83D\uDD0D \u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D");let t=bt.filter((e)=>e.required),n=bt.filter((e)=>!e.required);await wt(t,!1),await wt(n,!0),console.log(),m("","\u30B3\u30DE\u30F3\u30C9\u306E\u78BA\u8A8D\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}var g,bt;var W=$(()=>{g=G(T(),1);y();bt=[{name:"node",checkCommand:"node",installScript:fn,description:"Node.js (nvm\u7D4C\u7531)",required:!0},{name:"bun",checkCommand:"bun",installScript:"curl -fsSL https://bun.sh/install | bash",description:"Bun",required:!0},{name:"docker",checkCommand:"docker",installScript:dn,description:"Docker",required:!0},{name:"pulumi",checkCommand:"pulumi",installScript:"curl -fsSL https://get.pulumi.com | sh",description:"Pulumi",required:!0},{name:"doppler",checkCommand:"doppler",installScript:bn,description:"Doppler CLI",required:!0},{name:"coderabbit",checkCommand:"coderabbit",installScript:"curl -fsSL https://cli.coderabbit.ai/install.sh | sh",description:"CodeRabbit CLI",required:!1},{name:"claude",checkCommand:"claude",installScript:"curl -fsSL https://claude.ai/install.sh | bash",description:"Claude Code",required:!1},{name:"codex",checkCommand:"codex",installScript:wn,description:"Codex CLI",required:!1}]});var{$:b}=globalThis.Bun;import{existsSync as J}from"fs";import{join as E}from"path";async function St(){try{return await b`docker --version`.quiet(),!0}catch{return!1}}async function $t(t){try{return(await b`docker ps -a --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function kt(t){try{return(await b`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}async function X(t){try{return(await b`docker images --format {{.Repository}}:{{.Tag}}`.quiet()).stdout.toString().trim().split(`
`).some((s)=>s.startsWith(`${t}:`)||s===t)}catch{return!1}}async function Hn(t,n,e){let s=new d("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await b`docker build -t db -f ${n} ${e}`.cwd(t).quiet(),s.stop(!0,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function In(t,n,e){c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t db -f ${n} ${e}`.cwd(t).quiet(),c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function Un(t,n){let e=new d("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");e.start();try{await b`docker build -t e2e -f ${n} .`.cwd(t).quiet(),e.stop(!0,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){throw e.stop(!1,"E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),s}}async function jn(t,n){c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t e2e -f ${n} .`.cwd(t).quiet(),c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(e){throw c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),e}}async function Gn(t,n,e){let s=new d("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059");s.start();try{await b`docker build -t cache -f ${n} ${e}`.cwd(t).quiet(),s.stop(!0,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(o){throw s.stop(!1,"Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),o}}async function Fn(t,n,e){c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u3092\u30D3\u30EB\u30C9\u3057\u3066\u3044\u307E\u3059...","info");try{await b`docker build -t cache -f ${n} ${e}`.cwd(t).quiet(),c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(s){throw c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),s}}async function Vn(t,n){try{return(await b`docker exec -e MYSQL_PWD=${n} ${t} mysqladmin ping -h localhost -u root`.quiet()).exitCode===0}catch{return!1}}async function Qn(t,n){try{return(await b`docker exec ${t} redis-cli -a ${n} ping`.quiet()).stdout.toString().trim()==="PONG"}catch{return!1}}function O(t,n,e){if(t)t.stop(n,e);else c(e,n?"success":"warning")}async function Yn(t,n,e){for(let s=0;s<e;s++){if(await Vn(t,n))return!0;await new Promise((r)=>setTimeout(r,1000))}return!1}async function z(t,n=!0,e=30){let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=n?new d("MySQL\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await Yn(t,s,e))return O(o,!0,"MySQL\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return O(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return O(o,!1,"MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function Ln(t,n,e){for(let s=0;s<e;s++){if(await Qn(t,n))return!0;await new Promise((r)=>setTimeout(r,1000))}return!1}async function K(t,n=!0,e=30){let s=process.env.REDIS_PASSWORD||"password",o=n?new d("Redis\u306E\u8D77\u52D5\u3092\u5F85\u6A5F\u3057\u3066\u3044\u307E\u3059"):null;if(o)o.start();try{if(await Ln(t,s,e))return O(o,!0,"Redis\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F"),!0;return O(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F"),!1}catch{return O(o,!1,"Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),!1}}async function Wn(t,n,e){if(await kt(t)){c("MySQL\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await z(t,e);return}c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await b`docker start ${t}`.cwd(n).quiet(),await z(t,e)}async function zn(t,n,e){c("MySQL\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.MYSQL_ROOT_PASSWORD||"rootpassword",o=process.env.MYSQL_DATABASE||"portfolio",r=process.env.MYSQL_USER||"user",l=process.env.MYSQL_PASSWORD||"password";if(await b`docker run -d \
        --name ${t} \
        -p 3306:3306 \
        -e MYSQL_ROOT_PASSWORD=${s} \
        -e MYSQL_DATABASE=${o} \
        -e MYSQL_USER=${r} \
        -e MYSQL_PASSWORD=${l} \
        -v db-data:/var/lib/mysql \
        db`.cwd(n).quiet(),c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await z(t,e))c("MySQL\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function Kn(t,n,e){if(await kt(t)){c("Redis\u30B3\u30F3\u30C6\u30CA\u306F\u65E2\u306B\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059","success"),await K(t,e);return}c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info"),await b`docker start ${t}`.cwd(n).quiet(),await K(t,e)}async function Jn(t,n,e){c("Redis\u30B3\u30F3\u30C6\u30CA\u3092\u4F5C\u6210\u3057\u3066\u8D77\u52D5\u3057\u3066\u3044\u307E\u3059...","info");let s=process.env.REDIS_PASSWORD||"password";if(await b`docker run -d \
        --name ${t} \
        -p 6379:6379 \
        -e REDIS_PASSWORD=${s} \
        -v cache-data:/data \
        cache`.cwd(n).quiet(),c("Redis\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u307E\u3057\u305F","success"),!await K(t,e))c("Redis\u306E\u8D77\u52D5\u78BA\u8A8D\u304C\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u3057\u307E\u3057\u305F","warning")}async function Xn(t,n=!0){let s=E(t,".docker/db"),o=E(s,"Dockerfile");if(!J(o)){c("MySQL Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await St()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await X("db"))c("MySQL Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(n)await Hn(t,o,s);else await In(t,o,s);if(await $t("db")){await Wn("db",t,n);return}await zn("db",t,n)}catch(r){if(c("MySQL\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(r)}}async function Zn(t,n=!0){let s=E(t,".docker/cache"),o=E(s,"Dockerfile");if(!J(o)){c("Redis Dockerfile\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093","warning");return}try{if(!await St()){c("Docker\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093","warning");return}if(await X("cache"))c("Redis Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(n)await Gn(t,o,s);else await Fn(t,o,s);if(await $t("cache")){await Kn("cache",t,n);return}await Jn("cache",t,n)}catch(r){if(c("Redis\u30B3\u30F3\u30C6\u30CA\u306E\u8D77\u52D5\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(r)}}async function Z(t,n=!0){v("\uD83D\uDC33 Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9");let e=E(t,".docker/e2e/Dockerfile");if(J(e))try{if(await X("e2e"))c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306F\u65E2\u306B\u5B58\u5728\u3057\u307E\u3059","success");else if(n)await Un(t,e);else await jn(t,e)}catch(s){if(c("E2E\u7528Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),process.env.DEBUG)console.error(s)}await Xn(t,n),await Zn(t,n)}var Ot=$(()=>{y()});var{$:Nn}=globalThis.Bun;async function Et(t){v("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB");let n=new d("\u4F9D\u5B58\u95A2\u4FC2\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u3044\u307E\u3059");n.start();try{await Nn`bun install --ignore-scripts`.cwd(t).quiet(),n.stop(!0,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(e){if(n.stop(!1,"\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG)console.error(e);throw e}}var Rt=$(()=>{y()});var{$:B}=globalThis.Bun;import{existsSync as Bn,readFileSync as Dn,writeFileSync as At}from"fs";import{join as N}from"path";async function se(t){try{return(await B`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function oe(t){let n=t,e=n?.stderr?.toString()??n?.message??String(t);return te.exec(e)?.[1]?.trim()??null}function re(t){return t.length>80?`${t.substring(0,77)}...`:t}function ie(t){let n=t,e=n?.stderr?.toString()??n?.stdout?.toString()??n?.message??String(t);return ee.some((s)=>s.test(e))}function Pt(t,n){if(ie(t))n.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF08\u4E00\u90E8\u306E\u8B66\u544A\u3042\u308A\uFF09");else n.stop(!1,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306B\u5931\u6557\u3057\u307E\u3057\u305F");if(process.env.DEBUG){console.error(t);return}let s=oe(t);if(s)c(re(s),"warning")}function le(){let t=process.env.MYSQL_USER||"user",n=process.env.MYSQL_PASSWORD||"password",e=process.env.MYSQL_DATABASE||"portfolio",s=process.env.MYSQL_HOST||"localhost",o=process.env.MYSQL_PORT||"3306";return`mysql://${t}:${n}@${s}:${o}/${e}`}async function ae(t){let n=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");n.start();let e=N(t,"packages/db"),s=N(e,"prisma/schema/schema.prisma");if(!Bn(s)){n.stop(!1,"\u30B9\u30AD\u30FC\u30DE\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=le(),r=Dn(s,"utf-8"),l=r.replace(/provider\s*=\s*"sqlite"/,'provider = "mysql"');At(s,l);try{await B`DATABASE_URL=${o} bun run deploy`.cwd(e).quiet(),n.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(u){Pt(u,n)}finally{At(s,r)}}async function ce(t){let n=new d("Cloudflare D1\u306B\u5BFE\u3057\u3066\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u3092\u5B9F\u884C\u3057\u3066\u3044\u307E\u3059");n.start();let e=N(t,"packages/db");try{await B`bun run migrate`.cwd(e).quiet(),n.stop(!0,"\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){Pt(s,n)}}async function qt(t){if(v("\uD83D\uDD04 \u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3"),await se("db"))await ae(t);else await ce(t)}var te,ne,ee;var Mt=$(()=>{y();te=/Error:\s*([^\n]+)/,ne=/Duplicate key name/i,ee=[ne]});var{$:Tt}=globalThis.Bun;import{join as _t}from"path";async function D(t,n=!0){if(v("\uD83D\uDDC4\uFE0F  Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210"),n){let e=new d("Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059");e.start();try{await Tt`bun run generate`.cwd(_t(t,"packages/db")).quiet(),e.stop(!0,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(s){e.stop(!1,"Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),Ht(s)}}else{m("\uD83D\uDDC4\uFE0F","Prisma\u30B9\u30AD\u30FC\u30DE\u3092\u751F\u6210\u3057\u3066\u3044\u307E\u3059...","info");try{await Tt`bun run generate`.cwd(_t(t,"packages/db")).quiet(),m("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F","success")}catch(e){m("","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F","warning"),Ht(e)}}}function Ht(t){if(process.env.DEBUG){console.error(t);return}let n=t,e=n?.stderr?.toString()??n?.message??String(t),s=ue.exec(e);if(s?.[1]){let o=s[1].trim(),r=o.length>80?`${o.substring(0,77)}...`:o;c(r,"warning")}}var ue;var It=$(()=>{y();ue=/Error:\s*([^\n]+)/});var Ft={};st(Ft,{runWorkspace:()=>nt,findRootDir:()=>I});import{existsSync as Ut}from"fs";import{join as jt,resolve as tt}from"path";var{$:Gt}=globalThis.Bun;function I(t=process.cwd()){let n=tt(t),e=tt("/");while(n!==e){let s=jt(n,"package.json"),o=jt(n,"turbo.json");if(Ut(s)&&Ut(o))return n;n=tt(n,"..")}return process.cwd()}async function me(){if(process.versions?.bun!==void 0)return!0;try{if(Gt!==void 0)return await Gt`bun --version`.quiet(),!0}catch{return!1}return!1}function pe(t){return!t.env&&!t.install&&!t.schema&&!t.docker&&!t.migrate}function he(t){let n=pe(t);return{runEnv:n||t.env!==!1,runInstall:n||t.install!==!1,runSchema:n||t.schema!==!1,runDocker:n||t.docker!==!1,runMigrate:n||t.migrate!==!1,parallel:t.parallel??!0}}function fe(){console.log(),console.log(h.default.bold(h.default.cyan("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(h.default.bold(h.default.cyan("  \u2502  \uD83D\uDE80 \u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u958B\u59CB\u3057\u307E\u3059      \u2502"))),console.log(h.default.bold(h.default.cyan("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F")))}function de(){console.log(),console.log(h.default.bold(h.default.green("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.log(h.default.bold(h.default.green("  \u2502  \u2705 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\uFF01            \u2502"))),console.log(h.default.bold(h.default.green("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.log(),console.log(h.default.bold("  \u6B21\u306E\u30B9\u30C6\u30C3\u30D7:")),console.log(h.default.dim("    \u2022 \u5FC5\u8981\u306B\u5FDC\u3058\u3066 .docker/secrets/ \u306E\u5024\u3092\u7DE8\u96C6\u3057\u3066\u304F\u3060\u3055\u3044")),console.log(h.default.dim("    \u2022 bun run dev \u3067\u958B\u767A\u30B5\u30FC\u30D0\u30FC\uFF08docker compose up\uFF09\u3092\u8D77\u52D5\u3067\u304D\u307E\u3059")),console.log()}function ge(t){console.log(),console.error(h.default.bold(h.default.red("  \u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E"))),console.error(h.default.bold(h.default.red("  \u2502  \u2717 \u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u4E2D\u306B\u30A8\u30E9\u30FC\u304C\u767A\u751F\u3057\u307E\u3057\u305F    \u2502"))),console.error(h.default.bold(h.default.red("  \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F"))),console.error(),console.error(h.default.red("  "),t),console.error()}async function be(t,n){if(!n)return;if(process.env.BUN_LIFECYCLE_EVENT==="prepare"){let{logSection:s}=await Promise.resolve().then(() => (y(),dt));s("\uD83D\uDCE6 \u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB"),m("","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u30B9\u30AD\u30C3\u30D7\u3057\u307E\u3057\u305F\uFF08prepare\u30B9\u30AF\u30EA\u30D7\u30C8\u304B\u3089\u5B9F\u884C\u4E2D\uFF09","info");return}await Et(t)}async function we(t,n,e,s){let o=!s;if(s&&(n||e)){let r=[];if(n)r.push(D(t,o));if(e)r.push(Z(t,o));await Promise.all(r);return}if(n)await D(t,o);if(e)await Z(t,o)}async function nt(t={}){let n=I(),e=he(t);if(fe(),!await me())console.log(),console.error(h.default.red("  \u2717 Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u305B\u3093\u3002")),console.error(h.default.dim("    Bun\u3092\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3057\u3066\u304F\u3060\u3055\u3044: https://bun.sh")),process.exit(1);m("","Bun\u304C\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3055\u308C\u3066\u3044\u307E\u3059","success");try{if(await H(),e.runEnv)await L(n);if(await be(n,e.runInstall),await we(n,e.runSchema,e.runDocker,e.parallel),e.runMigrate)await qt(n);de()}catch(o){ge(o),process.exit(1)}}var h;var et=$(()=>{h=G(T(),1);W();Ot();y();Rt();Mt();It()});import{EventEmitter as Kt}from"events";function F(t){return t==null?[]:Array.isArray(t)?t:[t]}function Jt(t,n,e,s){var o,r=t[n],l=~s.string.indexOf(n)?e==null||e===!0?"":String(e):typeof e==="boolean"?e:~s.boolean.indexOf(n)?e==="false"?!1:e==="true"||(t._.push((o=+e,o*0===0)?o:e),!!e):(o=+e,o*0===0)?o:e;t[n]=r==null?l:Array.isArray(r)?r.concat(l):[r,l]}function Xt(t,n){t=t||[],n=n||{};var e,s,o,r,l,u={_:[]},i=0,a=0,f=0,p=t.length;let w=n.alias!==void 0,R=n.unknown!==void 0,U=n.default!==void 0;if(n.alias=n.alias||{},n.string=F(n.string),n.boolean=F(n.boolean),w)for(e in n.alias){s=n.alias[e]=F(n.alias[e]);for(i=0;i<s.length;i++)(n.alias[s[i]]=s.concat(e)).splice(i,1)}for(i=n.boolean.length;i-- >0;){s=n.alias[n.boolean[i]]||[];for(a=s.length;a-- >0;)n.boolean.push(s[a])}for(i=n.string.length;i-- >0;){s=n.alias[n.string[i]]||[];for(a=s.length;a-- >0;)n.string.push(s[a])}if(U){for(e in n.default)if(r=typeof n.default[e],s=n.alias[e]=n.alias[e]||[],n[r]!==void 0){n[r].push(e);for(i=0;i<s.length;i++)n[r].push(s[i])}}let S=R?Object.keys(n.alias):[];for(i=0;i<p;i++){if(o=t[i],o==="--"){u._=u._.concat(t.slice(++i));break}for(a=0;a<o.length;a++)if(o.charCodeAt(a)!==45)break;if(a===0)u._.push(o);else if(o.substring(a,a+3)==="no-"){if(r=o.substring(a+3),R&&!~S.indexOf(r))return n.unknown(o);u[r]=!1}else{for(f=a+1;f<o.length;f++)if(o.charCodeAt(f)===61)break;r=o.substring(a,f),l=o.substring(++f)||(i+1===p||(""+t[i+1]).charCodeAt(0)===45||t[++i]),s=a===2?[r]:r;for(f=0;f<s.length;f++){if(r=s[f],R&&!~S.indexOf(r))return n.unknown("-".repeat(a)+r);Jt(u,r,f+1<s.length||l,n)}}}if(U){for(e in n.default)if(u[e]===void 0)u[e]=n.default[e]}if(w)for(e in u){s=n.alias[e]||[];while(s.length>0)u[s.shift()]=u[e]}return u}var it=(t)=>t.replace(/[<[].+/,"").trim(),Zt=(t)=>{let n=/<([^>]+)>/g,e=/\[([^\]]+)\]/g,s=[],o=(u)=>{let i=!1,a=u[1];if(a.startsWith("..."))a=a.slice(3),i=!0;return{required:u[0].startsWith("<"),value:a,variadic:i}},r;while(r=n.exec(t))s.push(o(r));let l;while(l=e.exec(t))s.push(o(l));return s},Nt=(t)=>{let n={alias:{},boolean:[]};for(let[e,s]of t.entries()){if(s.names.length>1)n.alias[s.names[0]]=s.names.slice(1);if(s.isBoolean)if(s.negated){if(!t.some((r,l)=>{return l!==e&&r.names.some((u)=>s.names.includes(u))&&typeof r.required==="boolean"}))n.boolean.push(s.names[0])}else n.boolean.push(s.names[0])}return n},ot=(t)=>{return t.sort((n,e)=>{return n.length>e.length?-1:1})[0]},rt=(t,n)=>{return t.length>=n?t:`${t}${" ".repeat(n-t.length)}`},Bt=(t)=>{return t.replace(/([a-z])-([a-z])/g,(n,e,s)=>{return e+s.toUpperCase()})},Dt=(t,n,e)=>{let s=0,o=n.length,r=t,l;for(;s<o;++s)l=r[n[s]],r=r[n[s]]=s===o-1?e:l!=null?l:!!~n[s+1].indexOf(".")||!(+n[s+1]>-1)?{}:[]},tn=(t,n)=>{for(let e of Object.keys(n)){let s=n[e];if(s.shouldTransform){if(t[e]=Array.prototype.concat.call([],t[e]),typeof s.transformFunction==="function")t[e]=t[e].map(s.transformFunction)}}},nn=(t)=>{let n=/([^\\\/]+)$/.exec(t);return n?n[1]:""},lt=(t)=>{return t.split(".").map((n,e)=>{return e===0?Bt(n):n}).join(".")};class P extends Error{constructor(t){super(t);if(this.name=this.constructor.name,typeof Error.captureStackTrace==="function")Error.captureStackTrace(this,this.constructor);else this.stack=new Error(t).stack}}class at{constructor(t,n,e){if(this.rawName=t,this.description=n,this.config=Object.assign({},e),t=t.replace(/\.\*/g,""),this.negated=!1,this.names=it(t).split(",").map((s)=>{let o=s.trim().replace(/^-{1,2}/,"");if(o.startsWith("no-"))this.negated=!0,o=o.replace(/^no-/,"");return lt(o)}).sort((s,o)=>s.length>o.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null)this.config.default=!0;if(t.includes("<"))this.required=!0;else if(t.includes("["))this.required=!1;else this.isBoolean=!0}}var en=process.argv,sn=`${process.platform}-${process.arch} node-${process.version}`;class V{constructor(t,n,e={},s){this.rawName=t,this.description=n,this.config=e,this.cli=s,this.options=[],this.aliasNames=[],this.name=it(t),this.args=Zt(t),this.examples=[]}usage(t){return this.usageText=t,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(t,n="-v, --version"){return this.versionNumber=t,this.option(n,"Display version number"),this}example(t){return this.examples.push(t),this}option(t,n,e){let s=new at(t,n,e);return this.options.push(s),this}alias(t){return this.aliasNames.push(t),this}action(t){return this.commandAction=t,this}isMatched(t){return this.name===t||this.aliasNames.includes(t)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof Q}hasOption(t){return t=t.split(".")[0],this.options.find((n)=>{return n.names.includes(t)})}outputHelp(){let{name:t,commands:n}=this.cli,{versionNumber:e,options:s,helpCallback:o}=this.cli.globalCommand,r=[{body:`${t}${e?`/${e}`:""}`}];if(r.push({title:"Usage",body:`  $ ${t} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&n.length>0){let i=ot(n.map((a)=>a.rawName));r.push({title:"Commands",body:n.map((a)=>{return`  ${rt(a.rawName,i.length)}  ${a.description}`}).join(`
`)}),r.push({title:"For more info, run any command with the `--help` flag",body:n.map((a)=>`  $ ${t}${a.name===""?"":` ${a.name}`} --help`).join(`
`)})}let u=this.isGlobalCommand?s:[...this.options,...s||[]];if(!this.isGlobalCommand&&!this.isDefaultCommand)u=u.filter((i)=>i.name!=="version");if(u.length>0){let i=ot(u.map((a)=>a.rawName));r.push({title:"Options",body:u.map((a)=>{return`  ${rt(a.rawName,i.length)}  ${a.description} ${a.config.default===void 0?"":`(default: ${a.config.default})`}`}).join(`
`)})}if(this.examples.length>0)r.push({title:"Examples",body:this.examples.map((i)=>{if(typeof i==="function")return i(t);return i}).join(`
`)});if(o)r=o(r)||r;console.log(r.map((i)=>{return i.title?`${i.title}:
${i.body}`:i.body}).join(`

`))}outputVersion(){let{name:t}=this.cli,{versionNumber:n}=this.cli.globalCommand;if(n)console.log(`${t}/${n} ${sn}`)}checkRequiredArgs(){let t=this.args.filter((n)=>n.required).length;if(this.cli.args.length<t)throw new P(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:t,globalCommand:n}=this.cli;if(!this.config.allowUnknownOptions){for(let e of Object.keys(t))if(e!=="--"&&!this.hasOption(e)&&!n.hasOption(e))throw new P(`Unknown option \`${e.length>1?`--${e}`:`-${e}`}\``)}}checkOptionValue(){let{options:t,globalCommand:n}=this.cli,e=[...n.options,...this.options];for(let s of e){let o=t[s.name.split(".")[0]];if(s.required){let r=e.some((l)=>l.negated&&l.names.includes(s.name));if(o===!0||o===!1&&!r)throw new P(`option \`${s.rawName}\` value is missing`)}}}}class Q extends V{constructor(t){super("@@global@@","",{},t)}}var A=Object.assign;class ct extends Kt{constructor(t=""){super();this.name=t,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new Q(this),this.globalCommand.usage("<command> [options]")}usage(t){return this.globalCommand.usage(t),this}command(t,n,e){let s=new V(t,n||"",e,this);return s.globalCommand=this.globalCommand,this.commands.push(s),s}option(t,n,e){return this.globalCommand.option(t,n,e),this}help(t){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=t,this.showHelpOnExit=!0,this}version(t,n="-v, --version"){return this.globalCommand.version(t,n),this.showVersionOnExit=!0,this}example(t){return this.globalCommand.example(t),this}outputHelp(){if(this.matchedCommand)this.matchedCommand.outputHelp();else this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:t,options:n},e,s){if(this.args=t,this.options=n,e)this.matchedCommand=e;if(s)this.matchedCommandName=s;return this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(t=en,{run:n=!0}={}){if(this.rawArgs=t,!this.name)this.name=t[1]?nn(t[1]):"cli";let e=!0;for(let o of this.commands){let r=this.mri(t.slice(2),o),l=r.args[0];if(o.isMatched(l)){e=!1;let u=A(A({},r),{args:r.args.slice(1)});this.setParsedInfo(u,o,l),this.emit(`command:${l}`,o)}}if(e){for(let o of this.commands)if(o.name===""){e=!1;let r=this.mri(t.slice(2),o);this.setParsedInfo(r,o),this.emit("command:!",o)}}if(e){let o=this.mri(t.slice(2));this.setParsedInfo(o)}if(this.options.help&&this.showHelpOnExit)this.outputHelp(),n=!1,this.unsetMatchedCommand();if(this.options.version&&this.showVersionOnExit&&this.matchedCommandName==null)this.outputVersion(),n=!1,this.unsetMatchedCommand();let s={args:this.args,options:this.options};if(n)this.runMatchedCommand();if(!this.matchedCommand&&this.args[0])this.emit("command:*");return s}mri(t,n){let e=[...this.globalCommand.options,...n?n.options:[]],s=Nt(e),o=[],r=t.indexOf("--");if(r>-1)o=t.slice(r+1),t=t.slice(0,r);let l=Xt(t,s);l=Object.keys(l).reduce((p,w)=>{return A(A({},p),{[lt(w)]:l[w]})},{_:[]});let u=l._,i={"--":o},a=n&&n.config.ignoreOptionDefaultValue?n.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,f=Object.create(null);for(let p of e){if(!a&&p.config.default!==void 0)for(let w of p.names)i[w]=p.config.default;if(Array.isArray(p.config.type)){if(f[p.name]===void 0)f[p.name]=Object.create(null),f[p.name].shouldTransform=!0,f[p.name].transformFunction=p.config.type[0]}}for(let p of Object.keys(l))if(p!=="_"){let w=p.split(".");Dt(i,w,l[p]),tn(i,f)}return{args:u,options:i}}runMatchedCommand(){let{args:t,options:n,matchedCommand:e}=this;if(!e||!e.commandAction)return;e.checkUnknownOptions(),e.checkOptionValue(),e.checkRequiredArgs();let s=[];return e.args.forEach((o,r)=>{if(o.variadic)s.push(t.slice(r));else s.push(t[r])}),s.push(n),e.commandAction.apply(this,s)}}var ut=(t="")=>new ct(t);W();y();var{$:$n,spawn:kn}=globalThis.Bun;import{existsSync as On,readdirSync as En,readFileSync as Rn}from"fs";import{join as Ct}from"path";var An=/Error:\s*([^\n]+)/;async function Pn(t){try{return(await $n`docker ps --filter name=^${t}$ --format {{.Names}}`.quiet()).stdout.toString().trim()===t}catch{return!1}}function qn(t){let n=t,e=n?.stderr?.toString()??n?.message??String(t);return An.exec(e)?.[1]?.trim()??null}function Mn(t){return t.length>80?`${t.substring(0,77)}...`:t}function Tn(t,n){if(n.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u306B\u5931\u6557\u3057\u307E\u3057\u305F"),process.env.DEBUG){console.error(t);return}let e=qn(t);if(e)c(Mn(e),"warning")}async function _n(t){let n=new d("\u30ED\u30FC\u30AB\u30EBMySQL\u306B\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u3066\u3044\u307E\u3059");n.start();let e=Ct(t,".docker/db/seed");if(!On(e)){n.stop(!1,"\u30B7\u30FC\u30C9\u30C7\u30A3\u30EC\u30AF\u30C8\u30EA\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let s=En(e).filter((i)=>i.endsWith(".sql")).sort((i,a)=>i.localeCompare(a)).map((i)=>Ct(e,i));if(s.length===0){n.stop(!1,"\u30B7\u30FC\u30C9\u30D5\u30A1\u30A4\u30EB\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093");return}let o=process.env.MYSQL_USER||"user",r=process.env.MYSQL_PASSWORD||"password",l=process.env.MYSQL_DATABASE||"portfolio",u="db";try{for(let i of s){let a=i.split("/").pop()||i;c(`\u5B9F\u884C\u4E2D: ${a}`,"info");let f=Rn(i,"utf-8"),p=kn(["docker","exec","-i",u,"mysql","-u",o,`-p${r}`,l],{stdin:"pipe",stdout:"pipe",stderr:"pipe"});if(p.stdin.write(f),p.stdin.end(),await p.exited,p.exitCode!==0){let w=await p.stderr.text();throw new Error(`Failed to execute seed file ${a}: ${w}`)}}n.stop(!0,"\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F")}catch(i){throw Tn(i,n),i}}async function yt(t){if(v("\uD83C\uDF31 \u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u306E\u6295\u5165"),!await Pn("db")){c("MySQL\u30B3\u30F3\u30C6\u30CA\u304C\u8D77\u52D5\u3057\u3066\u3044\u307E\u305B\u3093","warning"),c("\u30B3\u30F3\u30C6\u30CA\u3092\u8D77\u52D5\u3057\u3066\u304B\u3089\u518D\u5EA6\u5B9F\u884C\u3057\u3066\u304F\u3060\u3055\u3044","info");return}await _n(t)}et();var k=ut("workspace");k.command("setup","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").option("--env","compose \u7528\u30B7\u30FC\u30AF\u30EC\u30C3\u30C8\uFF08.docker/secrets/\uFF09\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u306E\u307F\u5B9F\u884C").option("--install","\u4F9D\u5B58\u95A2\u4FC2\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u306E\u307F\u5B9F\u884C").option("--schema","Prisma\u30B9\u30AD\u30FC\u30DE\u306E\u751F\u6210\u306E\u307F\u5B9F\u884C").option("--docker","Docker\u30A4\u30E1\u30FC\u30B8\u306E\u30D3\u30EB\u30C9\u306E\u307F\u5B9F\u884C").option("--migrate","\u30C7\u30FC\u30BF\u30D9\u30FC\u30B9\u30DE\u30A4\u30B0\u30EC\u30FC\u30B7\u30E7\u30F3\u306E\u307F\u5B9F\u884C").option("--no-parallel","\u4E26\u5217\u5B9F\u884C\u3092\u7121\u52B9\u5316").action(async(t)=>{let n={env:t.env!==void 0,install:t.install!==void 0,schema:t.schema!==void 0,docker:t.docker!==void 0,migrate:t.migrate!==void 0,parallel:!t["no-parallel"]};await nt(n)});k.command("seed","\u30B7\u30FC\u30C9\u30C7\u30FC\u30BF\u3092\u6295\u5165\u3057\u307E\u3059").action(async()=>{let t=I();await yt(t)});k.command("check","\u5FC5\u8981\u306A\u30B3\u30DE\u30F3\u30C9\u306E\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u78BA\u8A8D\u3068\u5BFE\u8A71\u7684\u30A4\u30F3\u30B9\u30C8\u30FC\u30EB\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{await H()});k.command("*","\u958B\u767A\u74B0\u5883\u306E\u30BB\u30C3\u30C8\u30A2\u30C3\u30D7\u3092\u5B9F\u884C\u3057\u307E\u3059").action(async()=>{let{runWorkspace:t}=await Promise.resolve().then(() => (et(),Ft));await t()});k.help();k.version("1.0.1");k.parse();
