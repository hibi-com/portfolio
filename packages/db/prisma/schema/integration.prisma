enum SyncStatus {
    PENDING
    IN_PROGRESS
    COMPLETED
    FAILED

    @@map("sync_status")
}

enum SyncDirection {
    IMPORT
    EXPORT
    BIDIRECTIONAL

    @@map("sync_direction")
}

model FreeeIntegration {
    id                String    @id @default(uuid())
    userId            String    @map("user_id")
    companyId         Int       @map("company_id")
    companyName       String?   @map("company_name")
    accessToken       String    @map("access_token") @db.Text
    refreshToken      String    @map("refresh_token") @db.Text
    tokenExpiresAt    DateTime  @map("token_expires_at")
    scopes            String?
    isActive          Boolean   @default(true) @map("is_active")
    lastSyncAt        DateTime? @map("last_sync_at")
    createdAt         DateTime  @default(now()) @map("created_at")
    updatedAt         DateTime  @updatedAt @map("updated_at")

    user     User           @relation(fields: [userId], references: [id], onDelete: Cascade)
    syncLogs FreeeSyncLog[]

    @@unique([userId, companyId])
    @@index([userId])
    @@index([isActive])
    @@map("freee_integrations")
}

model FreeeSyncLog {
    id             String        @id @default(uuid())
    integrationId  String        @map("integration_id")
    direction      SyncDirection
    status         SyncStatus    @default(PENDING)
    entityType     String        @map("entity_type")
    totalRecords   Int?          @map("total_records")
    successCount   Int?          @map("success_count")
    errorCount     Int?          @map("error_count")
    errorDetails   String?       @map("error_details") @db.Text
    startedAt      DateTime?     @map("started_at")
    completedAt    DateTime?     @map("completed_at")
    createdAt      DateTime      @default(now()) @map("created_at")
    updatedAt      DateTime      @updatedAt @map("updated_at")

    integration FreeeIntegration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

    @@index([integrationId])
    @@index([status])
    @@index([createdAt])
    @@map("freee_sync_logs")
}

model CustomerFreeeMapping {
    id              String   @id @default(uuid())
    customerId      String   @map("customer_id")
    freeePartnerId  Int      @map("freee_partner_id")
    freeeCompanyId  Int      @map("freee_company_id")
    lastSyncAt      DateTime @map("last_sync_at")
    syncHash        String?  @map("sync_hash")
    createdAt       DateTime @default(now()) @map("created_at")
    updatedAt       DateTime @updatedAt @map("updated_at")

    customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

    @@unique([customerId, freeeCompanyId])
    @@unique([freeePartnerId, freeeCompanyId])
    @@index([freeePartnerId])
    @@map("customer_freee_mappings")
}

model DealFreeeMapping {
    id             String   @id @default(uuid())
    dealId         String   @map("deal_id")
    freeeDealId    Int      @map("freee_deal_id")
    freeeCompanyId Int      @map("freee_company_id")
    lastSyncAt     DateTime @map("last_sync_at")
    syncHash       String?  @map("sync_hash")
    createdAt      DateTime @default(now()) @map("created_at")
    updatedAt      DateTime @updatedAt @map("updated_at")

    deal Deal @relation(fields: [dealId], references: [id], onDelete: Cascade)

    @@unique([dealId, freeeCompanyId])
    @@unique([freeeDealId, freeeCompanyId])
    @@index([freeeDealId])
    @@map("deal_freee_mappings")
}
