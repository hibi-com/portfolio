---
name: review
description: コードレビューを実行します。
argument-hint: "[file-path|pr-number]"
allowed-tools: Bash, Read, Glob, Grep, Write
---

# Code Review Skill

コードレビューを実行し、結果を`logs/review/`に保存します。

## 使用方法

```text
/review                    # 現在の変更をレビュー
/review src/api/posts.ts   # 特定ファイルをレビュー
/review 123                # PR番号を指定してレビュー
```

## レビュープロセス

1. **対象ファイルの確認**: `git diff`または指定ファイルを読み込み
2. **レビュー実行**: 以下の観点でレビュー
3. **結果記録**: `logs/review/YYYY-MM-DD-{description}.md`に保存

## レビュー観点

詳細なレビュー観点は[コードレビューガイド](../../docs/development/code-review.md)を参照してください。

### 1. 品質レビュー（Code Quality）

#### 可読性（Readability）

- [ ] 変数名・関数名が意図を明確に表現している
- [ ] マジックナンバーを使用していない（定数化されている）
- [ ] 関数が単一責任原則に従っている（1つの関数が1つのことだけを行う）
- [ ] ネストが深すぎない（3階層以内）
- [ ] コメントが適切（自明なコードにコメント不要、複雑なロジックに説明あり）

#### 保守性（Maintainability）

- [ ] DRY原則に従っている（重複コードがない）
- [ ] ハードコーディングを避けている（環境変数、設定ファイル使用）
- [ ] エラーハンドリングが適切（tryキャッチ、エラーメッセージ）
- [ ] ログが適切に出力されている（デバッグ情報、エラーログ）
- [ ] 型定義が明示的（anyを使用していない）

#### テスタビリティ（Testability）

- [ ] 依存性注入が適切に行われている
- [ ] モックしやすい設計になっている
- [ ] 副作用が明確に分離されている
- [ ] テストが存在する（変更に対応するテスト）
- [ ] テストカバレッジが十分（MC/DC: Branches 100%）

### 2. セキュリティレビュー（Security）

#### OWASP Top 10対応

- [ ] **Injection**: SQLインジェクション、コマンドインジェクション対策（Prisma使用、バリデーション）
- [ ] **認証の不備**: 認証フローが適切（Better Auth使用、セッション管理）
- [ ] **機密データの露出**: APIキー、パスワードのハードコーディングなし
- [ ] **XXE**: XML解析の脆弱性対策（使用している場合）
- [ ] **アクセス制御の不備**: 権限チェックが適切
- [ ] **セキュリティ設定ミス**: HTTPSヘッダー、CORS設定が適切
- [ ] **XSS**: クロスサイトスクリプティング対策（入力のサニタイズ）
- [ ] **安全でないデシリアライゼーション**: 信頼できないデータの使用
- [ ] **既知の脆弱性**: 依存パッケージの脆弱性チェック
- [ ] **不十分なロギングと監視**: セキュリティイベントのログ記録

#### その他セキュリティ

- [ ] 環境変数が`.env`ファイルで管理されている
- [ ] `.gitignore`に機密情報が含まれていない
- [ ] Rate Limitingが実装されている（API）
- [ ] CSRFトークンが実装されている（必要な場合）

### 3. パフォーマンスレビュー（Performance）

#### データベース

- [ ] N+1クエリ問題がない（`include`/`select`の適切な使用）
- [ ] インデックスが適切に設定されている
- [ ] 不要なデータを取得していない（`select`で必要なフィールドのみ）
- [ ] トランザクションが適切に使用されている

#### フロントエンド

- [ ] 不要な再レンダリングがない（`useMemo`、`useCallback`の適切な使用）
- [ ] コード分割が適切（動的import）
- [ ] 画像が最適化されている（サイズ、フォーマット）
- [ ] メモリリークがない（EventListener解除、useEffectクリーンアップ）

#### API

- [ ] レスポンスサイズが適切（ペイロード最小化）
- [ ] キャッシュが適切に使用されている
- [ ] 並行処理が適切（`Promise.all`の使用）

### 4. アーキテクチャレビュー（Architecture）

#### DDD準拠（API）

- [ ] レイヤー分離が適切（Domain、UseCase、Infrastructure、Interface）
- [ ] 依存関係が正しい方向（内側から外側へ）
- [ ] ドメインロジックがDomain層に集約されている
- [ ] Repository経由でのデータアクセス（直接Prismaを呼ばない）
- [ ] DIコンテナ経由での依存注入

#### FSD準拠（Frontend）

- [ ] レイヤー分離が適切（routes、widgets、features、entities、shared）
- [ ] 下位レイヤーが上位レイヤーをインポートしていない
- [ ] featuresが独立している（他のfeaturesに依存しない）
- [ ] 共通ロジックがsharedに配置されている

#### 一般

- [ ] 単一責任原則（SRP）に従っている
- [ ] オープン・クローズド原則（OCP）に従っている
- [ ] インターフェース分離原則（ISP）に従っている
- [ ] 依存性逆転原則（DIP）に従っている

### 5. テストレビュー（Testing）

#### テストハニカム戦略

- [ ] Medium Tests（統合テスト）が優先的に書かれている
- [ ] Small Tests（ユニットテスト）は複雑なロジックのみ
- [ ] Large Tests（E2E）はクリティカルパスのみ

#### テスト品質

- [ ] Given/When/Then形式で記述されている
- [ ] テストケース名が明確
- [ ] アサーションが適切
- [ ] モックの使用が最小限
- [ ] テストが独立している（他のテストに依存しない）

### 6. ドキュメントレビュー（Documentation）

- [ ] シーケンス図が更新されている（APIフロー変更時）
- [ ] API仕様書が更新されている（エンドポイント変更時）
- [ ] README/ドキュメントが更新されている（必要な場合）
- [ ] コメントが適切（複雑なロジックのみ）
- [ ] JSDocが記載されている（公開API）

## レビュー結果の記録

レビュー完了後、以下のテンプレートで結果を`logs/review/`に保存してください。

**ファイル名**: `logs/review/YYYY-MM-DD-{description}.md`

テンプレート: `.claude/templates/workflow/code-review-log.md`

## 参考ドキュメント

レビュー基準、コードスタイル、セキュリティガイドラインについては以下を参照：

- [コードレビューガイド](../../docs/development/code-review.md) - レビュー観点詳細、良い例・悪い例
- [コーディング規約](../../docs/development/coding-standards.md) - フォーマット、命名規則、TypeScript規約
- [セキュリティガイドライン](../../docs/security/guidelines.md) - OWASP対応、機密情報管理
- [テスト戦略](../../docs/testing/testing-strategy.md) - テストハニカム、カバレッジ基準

## 出力フォーマット

レビュー結果は以下の形式で出力してください：

```markdown
## レビュー結果サマリー

- **対象**: {ファイルパスまたはPR番号}
- **レビュー日時**: {YYYY-MM-DD HH:mm}
- **レビュアー**: Claude Code
- **総合評価**: ✅ 承認 / ⚠️ 要修正 / ❌ 却下

## 🔴 クリティカル（即修正必須）

- [ ] {項目}

## 🟠 重要（修正推奨）

- [ ] {項目}

## 🟡 軽微（任意）

- [ ] {項目}

## ✅ 良い点

- {項目}

## 📝 コメント

{詳細コメント}
```

## 自動チェック

レビュー実行前に以下のコマンドを自動実行してください：

```bash
# コード品質チェック
bun run lint
bun run typecheck

# テスト実行
bun run test

# カバレッジ確認
bun run coverage
```
