---
files: ["**/*"]
alwaysApply: true
---

# 自動エージェント・スキルアサインルール

## IMPORTANT: コンテキストに応じて適切なエージェント/スキルを自動で使用する

以下のトリガー条件に合致した場合、対応するエージェントまたはスキルを**自動的に**使用してください。  
ユーザーへの確認は不要です。

## エージェント自動アサイン

### 仕様・設計フェーズ

| トリガー | アサインするエージェント |
| -------- | ------------------------ |
| 「新機能を実装して」「○○機能を追加して」 | `spec-writer-agent` → 仕様書作成後に実装 |
| 「シーケンス図を作成して」「API仕様を書いて」 | `spec-writer-agent` |
| 「DBスキーマを設計して」 | `spec-writer-agent` + `db-migration-agent` |

### テストフェーズ

| トリガー | アサインするエージェント |
| -------- | ------------------------ |
| 「テストを書いて」（実装前） | `unit-test-agent`（TDD Red） |
| 「ユニットテストを実行して」 | `unit-test-runner` |
| 「統合テストを書いて」 | `integration-test-agent` |
| 「統合テストを実行して」 | `integration-test-runner` |
| 「E2Eテストを書いて」 | `e2e-test-agent` |
| 「E2Eテストを実行して」 | `e2e-test-runner` |

### 実装フェーズ

| トリガー | アサインするエージェント |
| -------- | ------------------------ |
| DBスキーマ変更時 | `db-migration-agent` |
| 実装完了後 | `lint-runner` → `unit-test-runner` |
| PR作成前 | `review-agent` |

### ビルド・デプロイフェーズ

| トリガー | アサインするエージェント |
| -------- | ------------------------ |
| 「ビルドして」 | `build-agent` |
| 「型チェックして」 | `build-agent` |
| ビルドエラー発生時 | `build-agent`（エラー解析） |

**重要**: デプロイはCircleCI自動化のみ。ローカルからの手動デプロイは禁止。`bun run deploy`はテスト目的のみ使用可。

### 調査フェーズ

| トリガー | アサインするエージェント |
| -------- | ------------------------ |
| 「○○の使い方を調べて」 | `tech-docs-searcher` |
| 外部ライブラリの調査 | `tech-docs-searcher` |

## スキル自動アサイン

### 開発ワークフロー

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「コミットして」 | `/commit` |
| 「PRを作成して」 | `/pr` |
| 「レビューして」 | `/review` |

### テスト実行

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「テストを実行して」（単体） | `/unit-test` |
| 「統合テストを実行して」 | `/integration-test` |
| 「E2Eテストを実行して」 | `/e2e-test` |

### コード品質

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「リントして」「Lintを実行して」 | `/lint` |
| 「フォーマットして」 | `/format` |
| 「型チェックして」 | `/typecheck` |

### DB操作

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「マイグレーションを実行して」 | `/db-migrate` |
| 「DBスキーマを更新して」 | `/db-migrate dev --name xxx` |

### ビルド

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「ビルドして」 | `/build` |
| 「モックを生成して」 | `/gen-mock` |

### 同期

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「ドキュメントを同期して」 | `/sync-docs` |
| 「ナレッジを更新して」 | `/sync-knowledge` |
| 「設定を同期して」 | `/sync-settings` |

### バージョン管理

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「changesetを作成して」「バージョンアップして」 | `/changeset` |
| 「リリース準備して」 | `/changeset` |

### セキュリティ

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「セキュリティチェックして」「OWASP チェックして」 | `/security` |
| 「脆弱性チェックして」 | `/security` |

### 依存関係管理

| トリガー | アサインするスキル |
| -------- | ------------------ |
| 「依存関係を更新して」「パッケージを更新して」 | `/update-deps` |
| 「outdatedをチェックして」 | `/update-deps` |
| 「npm updateして」「bun updateして」 | `/update-deps` |

## ワークフロー自動実行

### 新機能実装ワークフロー

ユーザーが「○○機能を実装して」と言った場合：

1. `spec-writer-agent` → シーケンス図・API仕様作成
2. `unit-test-agent` → テスト作成（Red）
3. 実装
4. `bun run test` → テスト実行（Green）
5. `bun run lint` + `bun run fmt` → コード品質チェック
6. `review-agent` → コードレビュー

### バグ修正ワークフロー

ユーザーが「○○を修正して」と言った場合：

1. バグ再現テスト作成
2. 修正実装
3. `bun run test` → テスト実行
4. `bun run lint` → リントチェック

### リファクタリングワークフロー

ユーザーが「○○をリファクタリングして」と言った場合：

1. `bun run test` → 既存テスト確認
2. リファクタリング実施
3. `bun run test` → テスト再実行
4. `bun run lint` + `bun run typecheck` → 品質チェック

### リリースワークフロー

ユーザーが「リリースして」「バージョンアップして」と言った場合：

1. `/changeset` → changeset作成
2. `bun run test` → 全テスト実行
3. `bun run lint` + `bun run typecheck` → 品質チェック
4. changesetがバージョン更新を自動実行（`.changeset/`ディレクトリから）
5. `/pr` → Pull Request作成

**重要**: デプロイはCircleCI自動化のみ。ローカルからの手動デプロイは禁止。

## ファイルパターンによる自動アサイン

| ファイルパターン | 自動アサイン |
| ---------------- | ------------ |
| `*.test.ts` 作成時 | `unit-test-runner` でテスト実行 |
| `*.medium.test.ts` 作成時 | `integration-test-runner` でテスト実行 |
| `*.large.spec.ts` 作成時 | `e2e-test-runner` でテスト実行 |
| `*.prisma` 変更時 | `db-migration-agent` でマイグレーション提案 |
| `docs/sequence/**` 変更時 | `/sync-docs` で整合性チェック提案 |
