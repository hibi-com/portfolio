# OWASP Top 10 セキュリティチェック

**チェック日**: {DATE}
**チェック担当**: {CHECKER}
**対象期間**: {START_DATE} 〜 {END_DATE}

---

## チェック概要

このチェックリストは、OWASP Top 10 (2021) に基づいて隔週でプロジェクトのセキュリティを評価するためのものです。

## A01:2021 - アクセス制御の不備

### チェック項目

- [ ] すべての保護されたリソースに認証チェックがある
- [ ] ロールベースのアクセス制御が実装されている
- [ ] 直接オブジェクト参照（IDOR）が防止されている
- [ ] 認可バイパスのテストが実施されている
- [ ] デフォルトで拒否するポリシーが適用されている

### 確認コマンド

```bash
# 認証ミドルウェアの適用状況を確認
grep -r "authMiddleware\|requireRole" apps/api/src/interface/rest/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A02:2021 - 暗号化の失敗

### チェック項目

- [ ] すべての通信がHTTPS/TLSで暗号化されている
- [ ] パスワードが適切にハッシュ化されている（bcrypt/argon2）
- [ ] 機密データが保存時に暗号化されている
- [ ] 弱い暗号アルゴリズムが使用されていない
- [ ] 暗号鍵が安全に管理されている

### 確認コマンド

```bash
# Cloudflare HTTPS設定確認
curl -I https://your-domain.com | grep -i "strict-transport-security"

# wrangler secretsの確認
wrangler secret list
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A03:2021 - インジェクション

### チェック項目

- [ ] すべてのユーザー入力がバリデーションされている
- [ ] パラメータ化クエリ/ORMが使用されている
- [ ] 出力がコンテキストに応じてエスケープされている
- [ ] コマンドインジェクションが防止されている
- [ ] XSSが防止されている

### 確認コマンド

```bash
# Zodバリデーションの使用状況確認
grep -r "z\." packages/validation/src/

# Prismaの使用確認（生SQLの検索）
grep -r "\$queryRaw\|\$executeRaw" packages/db/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A04:2021 - 安全でない設計

### チェック項目

- [ ] 脅威モデリングが実施されている
- [ ] セキュリティ要件が定義されている
- [ ] セキュアな設計パターンが使用されている
- [ ] ビジネスロジックの脆弱性がテストされている
- [ ] レート制限が実装されている

### 確認コマンド

```bash
# レート制限の実装確認
grep -r "rateLimit\|throttle" apps/api/src/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A05:2021 - セキュリティの設定ミス

### チェック項目

- [ ] 不要な機能が無効化されている
- [ ] デフォルト認証情報が変更されている
- [ ] エラーメッセージがスタックトレースを含まない
- [ ] セキュリティヘッダーが設定されている
- [ ] 最新のセキュリティパッチが適用されている

### 確認コマンド

```bash
# セキュリティヘッダー確認
curl -I https://your-domain.com

# .env ファイルの権限確認
find . -name ".env*" -exec ls -la {} \;
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A06:2021 - 脆弱で古いコンポーネント

### チェック項目

- [ ] 依存関係が最新に保たれている
- [ ] 既知の脆弱性がないことが確認されている
- [ ] 使用していないコンポーネントが削除されている
- [ ] ソフトウェア構成表（SBOM）が維持されている
- [ ] 自動更新の仕組みがある

### 確認コマンド

```bash
# 脆弱性チェック
bun audit

# 更新可能パッケージ確認
bun outdated

# 未使用パッケージ確認
bunx depcheck
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A07:2021 - 識別と認証の失敗

### チェック項目

- [ ] 強力なパスワードポリシーが適用されている
- [ ] ブルートフォース攻撃が防止されている
- [ ] セッション管理が安全である
- [ ] MFA（多要素認証）がサポートされている
- [ ] パスワードリセットが安全に実装されている

### 確認コマンド

```bash
# パスワードポリシーの確認
grep -r "password.*validation\|passwordPolicy" packages/validation/src/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A08:2021 - ソフトウェアとデータの整合性の失敗

### チェック項目

- [ ] CI/CDパイプラインが保護されている
- [ ] 依存関係の整合性が検証されている
- [ ] シリアライズされたデータが検証されている
- [ ] コード署名が実装されている
- [ ] 自動更新機能が安全である

### 確認コマンド

```bash
# CI/CDワークフローの確認
cat .github/workflows/ci.yml

# Trivyスキャン実行
trivy fs --severity HIGH,CRITICAL .
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A09:2021 - セキュリティログとモニタリングの失敗

### チェック項目

- [ ] ログインの成功/失敗がログに記録されている
- [ ] アクセス制御の失敗がログに記録されている
- [ ] ログが改ざんから保護されている
- [ ] アラートが適切に設定されている
- [ ] インシデント対応計画がある

### 確認コマンド

```bash
# ログ出力の確認
grep -r "logger\.\(info\|warn\|error\)" apps/api/src/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## A10:2021 - サーバーサイドリクエストフォージェリ (SSRF)

### チェック項目

- [ ] ユーザー提供のURLが検証されている
- [ ] 内部ネットワークへのアクセスがブロックされている
- [ ] リダイレクトが制限されている
- [ ] 許可リストによるURL検証がある
- [ ] DNSリバインディングが防止されている

### 確認コマンド

```bash
# URL検証の実装確認
grep -r "validateUrl\|isPrivateIp" apps/api/src/lib/
```

### 発見事項

```
{FINDINGS}
```

### アクション

```
{ACTIONS}
```

---

## サマリー

### 総合評価

| カテゴリ | 状態 | 備考 |
| -------- | ---- | ---- |
| A01: アクセス制御 | {STATUS} | {NOTE} |
| A02: 暗号化 | {STATUS} | {NOTE} |
| A03: インジェクション | {STATUS} | {NOTE} |
| A04: 安全でない設計 | {STATUS} | {NOTE} |
| A05: 設定ミス | {STATUS} | {NOTE} |
| A06: 古いコンポーネント | {STATUS} | {NOTE} |
| A07: 認証の失敗 | {STATUS} | {NOTE} |
| A08: 整合性の失敗 | {STATUS} | {NOTE} |
| A09: ログとモニタリング | {STATUS} | {NOTE} |
| A10: SSRF | {STATUS} | {NOTE} |

**状態凡例**: ✅ 問題なし / ⚠️ 要注意 / ❌ 要対応

### 優先度の高いアクション

1. {HIGH_PRIORITY_ACTION_1}
2. {HIGH_PRIORITY_ACTION_2}
3. {HIGH_PRIORITY_ACTION_3}

### 次回チェック予定

- **次回実施日**: {NEXT_CHECK_DATE}
- **担当者**: {NEXT_CHECKER}

---

## 参考資料

- [OWASP Top 10 2021](https://owasp.org/Top10/)
- [プロジェクトセキュリティガイドライン](docs/security/guidelines.md)
- [公開用OWASPチェックリスト](docs/security/owasp-checklist.md)
