# PR作成テンプレート

## IMPORTANT: このテンプレートと`.github/PULL_REQUEST_TEMPLATE.md`に従ってPRを作成すること

## PR作成前チェックリスト

### コード品質

- [ ] `bun run lint` が通過
- [ ] `bun run typecheck` が通過
- [ ] `bun run test` が通過
- [ ] 不要なconsole.log/デバッグコードを削除

### ドキュメント

- [ ] 必要に応じてシーケンス図を更新/作成
- [ ] 必要に応じてAPI仕様を更新/作成
- [ ] 関連ドキュメントの更新が必要か確認

### Git

- [ ] コミットメッセージがConventional Commits形式
- [ ] コミットが論理的な単位で分割されている
- [ ] ブランチ名が適切（`feat/xxx`, `fix/xxx`, `refactor/xxx`）

## PR情報収集

```bash
# 変更概要
git diff --stat main...HEAD

# コミット履歴
git log --oneline main...HEAD

# 変更ファイル
git diff --name-only main...HEAD
```

## PRタイトル規則

```text
{type}: {簡潔な説明}
```

### Type一覧

| Type | 用途 | 例 |
| ---- | ---- | -- |
| feat | 新機能 | `feat: ユーザー認証機能を追加` |
| fix | バグ修正 | `fix: ログイン時のエラーを修正` |
| refactor | リファクタリング | `refactor: UserServiceの責務を分離` |
| docs | ドキュメント | `docs: API仕様書を更新` |
| test | テスト | `test: UserServiceのテストを追加` |
| chore | その他 | `chore: 依存関係を更新` |

## PR本文テンプレート

プロジェクトの`.github/PULL_REQUEST_TEMPLATE.md`を使用する。
テンプレートの構成:

```markdown
## Why / なぜ

{なぜこの変更が必要なのか、背景や課題を記述}

## Goal / 目標

{この変更によって達成したい目標を記述}

## Verification / 動作検証

{動作検証の結果を記述}
```

## PR作成コマンド

```bash
# ブランチをプッシュ
git push -u origin {branch-name}

# PRを作成（テンプレートを使用）
gh pr create --title "{type}: {title}" --body "$(cat <<'EOF'
## Why / なぜ

{背景・課題の説明}

## Goal / 目標

{達成したい目標}

## Verification / 動作検証

- [ ] ローカルで動作確認済み
- [ ] テスト通過確認済み
- [ ] レビューポイントの説明
EOF
)"
```

## セルフレビューチェックリスト

PRを作成する前に、以下を確認:

### コード品質

- [ ] 不要なコメントやデバッグコードがない
- [ ] 命名規則に従っている
- [ ] エラーハンドリングが適切
- [ ] セキュリティ上の問題がない

### テスト

- [ ] 新しいコードにテストがある
- [ ] 既存のテストが通過する
- [ ] エッジケースがテストされている

### ドキュメント

- [ ] コードの意図がコメントで説明されている（必要な場合）
- [ ] API変更がある場合、仕様書が更新されている
- [ ] シーケンス図が最新

## レビュー依頼

### レビュアー選定基準

| 条件 | レビュアー |
| ---- | ---------- |
| バックエンド変更 | バックエンドチーム |
| フロントエンド変更 | フロントエンドチーム |
| インフラ変更 | インフラチーム |
| セキュリティ関連 | セキュリティ担当 |

### レビュー依頼コメント

```markdown
@{reviewer}

レビューをお願いします。

**変更概要**: {概要}

**特に見てほしい点**:
- {ポイント1}
- {ポイント2}

**確認済み事項**:
- [x] テスト通過
- [x] 型チェック通過
- [x] リント通過
```

## マージ後の確認

### チェックリスト

- [ ] CIが全て通過
- [ ] ステージング環境で動作確認
- [ ] 本番デプロイ（必要な場合）
- [ ] 関連Issueをクローズ

### デプロイ確認

```bash
# デプロイステータス確認
gh run list --workflow=deploy

# 本番ログ確認
wrangler tail --format=pretty
```

## 出力フォーマット

```markdown
## PR作成完了

### PR情報

- **URL**: {pr-url}
- **タイトル**: {title}
- **ブランチ**: {branch} → {base}

### 変更サマリー

| 項目 | 値 |
| ---- | -- |
| 変更ファイル数 | {count} |
| 追加行 | {additions} |
| 削除行 | {deletions} |
| コミット数 | {commits} |

### 次のアクション

- [ ] レビュアーにメンション
- [ ] CI通過を確認
- [ ] レビュー対応
- [ ] マージ
```
